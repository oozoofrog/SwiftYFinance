# SwiftYFinance 개발 가이드

SwiftYFinance 프로젝트의 핵심 개발 방법론과 아키텍처 원칙

## 🔄 TDD 방법론

### Red → Green → Refactor 사이클
- **Red Phase (🔴)**: 실패하는 작은 테스트 작성
- **Green Phase (🟢)**: 최소한의 구현으로 테스트 통과
- **Refactor Phase (🟡)**: 모든 테스트 통과 상태에서만 코드 품질 개선

### TDD 핵심 원칙
- 한 번에 하나의 테스트만 작업
- 과도한 구현 금지 - 테스트가 요구하는 것만 구현
- Swift Testing 프레임워크 사용
- 각 테스트는 독립적으로 실행 가능

## 🧹 Tidy First 원칙

Kent Beck의 "Tidy First?" 방법론에 따라 구조 변경과 기능 변경을 명확히 분리

### 기본 원칙
- **구조 변경 먼저**: 코드 정리를 기능 추가보다 우선
- **별도 커밋**: 구조 변경과 기능 변경은 절대 같은 커밋에 포함하지 않음
- **작은 단위**: 한 번에 하나씩 작은 개선 수행

### 커밋 유형
```
[Tidy] - 리팩토링, 이름 변경, 파일 분리 등 구조 개선
[Refactor] - 아키텍처 개선, 패턴 적용
[Implement] - 새로운 기능 구현
[Fix] - 버그 수정
[Test] - 테스트 추가 또는 수정
[Docs] - 문서 업데이트
[Cleanup] - 불필요한 파일 제거
```

### 작업 순서
1. 코드가 지저분하면 먼저 정리 (Tidy/Refactor)
2. 테스트가 모두 통과하는지 확인
3. 정리된 코드에 새 기능 추가 (Implement)
4. 다시 정리가 필요하면 별도 커밋으로 정리

## 🏗️ Protocol + Struct 아키텍처

### OOP 설계 원칙
- **Protocol-Oriented Programming**: 프로토콜 기반 설계
- **Composition over Inheritance**: 상속보다는 컴포지션
- **Single Responsibility**: 각 구조체는 하나의 명확한 책임
- **Dependency Injection**: YFClient를 통한 의존성 주입

### 서비스 아키텍처 패턴
- `YFService` 프로토콜로 일관된 인터페이스 정의
- `YFServiceCore`를 통한 공통 로직 재사용 (Composition)
- 각 도메인별 서비스 구조체 (`YFQuoteService`, `YFNewsService` 등)
- YFClient computed property로 서비스 접근

### 관심사 분리
- **모델**: 순수한 데이터 구조, API 호출 금지
- **서비스**: 도메인별 비즈니스 로직
- **클라이언트**: 모든 API 호출의 진입점
- **코어**: 공통 로직과 네트워크 처리

## 📋 작업 진행 패턴

### 1. 분석 단계 (RESEARCH MODE)
- 기존 문서 및 코드 현황 파악
- 이전 커밋 로그 분석으로 진행 상황 이해
- 관련 파일들 읽기 (모델, 서비스, 테스트, yfinance-reference)
- 문제점 및 개선점 식별

### 2. 계획 단계 (PLAN MODE)
- TDD + OOP + Tidy First 원칙 적용한 상세 계획 수립
- 구체적인 파일 경로, 함수명, 변경사항 명시
- 체크리스트 형태로 구현 단계 정리

### 3. 실행 단계 (EXECUTE MODE)
- Red → Green → Refactor 사이클 엄격 준수
- 한 번에 하나의 테스트만 작업
- 최소한의 코드로 테스트 통과
- TodoWrite로 진행상황 실시간 추적

## 📊 TodoWrite 활용

### 작업 관리 원칙
- **작업 시작시**: 즉시 `in_progress`로 변경
- **완료시**: 즉시 `completed`로 변경
- **배치 처리 금지**: 여러 작업을 한 번에 완료 처리 금지
- **실시간 추적**: 진행 상황을 지속적으로 업데이트

### 작업 단위
- 구체적이고 실행 가능한 단위로 세분화
- 파일별, 기능별로 명확하게 구분
- 테스트와 구현을 별도 작업으로 관리

## 🔍 yfinance-reference 활용

### 참조 코드 분석
- Python yfinance 구현체의 API 구조 파악
- 필드 매핑 및 응답 형식 확인
- 호환성 유지를 위한 구현 방향 결정
- Yahoo Finance API 엔드포인트 및 파라미터 확인

### JSON 샘플 활용
- 실제 API 응답 구조 파악을 위한 샘플 생성
- 모델 정확성 검증용 테스트 데이터
- CLI를 통한 자동 샘플 생성 및 업데이트
- 명명 규칙: `API-TICKER` 형식 사용

## 🖥️ CLI 개발 라이프사이클

### CLI의 역할
- JSON 샘플 자동 생성 및 업데이트
- 개발 과정에서 API 응답 검증
- 모델 검증 및 디버깅 지원
- 각 서비스별 전용 명령어 제공

### 명령어 개발 패턴
- 각 새로운 서비스 구현시 해당 CLI 명령어도 함께 개발
- JSON 샘플 생성 자동화
- 실제 API 호출을 통한 응답 구조 확인
- 테스트 데이터 생성 및 검증

## 🌊 Swift 동시성 원칙

### Sendable 준수 전략
- **Struct 우선**: 가능한 한 struct 사용하여 value semantics 활용
- **Final Class**: 참조 타입 필요시 final로 선언
- **Actor 활용**: mutable 상태는 actor로 격리하여 데이터 레이스 방지
- **@unchecked Sendable**: 반드시 필요한 경우에만 신중하게 사용

### 동시성 안전 패턴
- 모든 actor 접근은 async/await 사용
- 상태 변경의 원자성 보장
- Internal State Actor 패턴으로 복잡한 상태 관리

## 📏 파일 크기 관리

### 분리 기준
- **250줄 초과**: 분리 검토 시작
- **300줄 초과**: 강제 분리 실행
- **테스트 파일**: 15개 메서드 초과 시 검토, 20개 초과 시 분리

### 분리 전략
- 기능별 분리로 도메인 로직 명확화
- YFClient 확장 파일 활용
- 관련 모델끼리 그룹화
- public 인터페이스 유지하며 내부 구조만 정리

## 🎯 품질 보장

### 코드 품질
- Swift 6.1 최신 기능 활용
- Async/Await 현대적 동시성
- 모듈화 설계로 결합도 최소화
- 명확한 네이밍 컨벤션 준수

### 테스트 전략
- 단위 테스트와 통합 테스트 분리
- 실제 API 호출을 통한 end-to-end 테스트
- 동시성 시나리오에 대한 별도 테스트
- 각 테스트는 독립적으로 실행 가능

### 에러 처리
- Swift Result 타입과 throws/try 활용
- 네트워크부터 데이터 파싱까지 포괄적 처리
- 명확한 에러 메시지와 복구 가이드

## 🚀 지속적 개선

### 리팩토링 원칙
- 테스트 통과 상태에서만 리팩토링 진행
- 작은 단위로 점진적 개선
- [Tidy]/[Refactor] 커밋으로 구조 변경 분리
- 기능 변경과 구조 변경 절대 혼합 금지

### 개발 사이클
1. **분석**: 현재 상태 파악 및 문제 식별
2. **계획**: TDD + Tidy First 기반 상세 계획
3. **정리**: 필요시 구조 정리 (별도 커밋)
4. **구현**: Red → Green → Refactor 사이클
5. **통합**: CLI 명령어 및 JSON 샘플 업데이트
6. **검증**: 테스트 실행 및 품질 확인

이 가이드를 통해 일관된 품질과 효율성을 유지하며 SwiftYFinance 프로젝트를 발전시켜 나갈 수 있습니다.